# 平台介绍
## 整体架构

优品量化平台主要分为三个部分，WEB平台、SDK、量化引擎（用户不可见）。用户使用 SDK来完成策略编写，策略运行后和量化引擎服务通过网络通讯，最终的运行过程和结果都在WEB平台上展示。这几个模块间的通讯采用了异步事件实时通信机制，可以保证数据的准实时性，延时基本都可以控制在5ms左右。

平台的整体架构图如下:

![](http://cdn.upchina.com/uptest/201801/6a71670d57bafe25b64867b9b1ecff4a.jpg)


优品量化平台重要的特点如下:

（1）策略和引擎分离的模式, 策略在本地运行, 和云端引擎实时异步通讯来完成回测, 模拟, 实盘等操作,  保证了策略代码的绝对安全, 当然前提是要求本机安装优品量化平台的SDK;  
（2）底层采用c++来实现, 整体架构采取了全异步架构, 保证系统的高效率, 而SDK同时支持c++和python两种开发语言, 保证了策略开发的便利性;  
（3）整体架构采取全异步架构, 云端引擎完全模拟行情回放和撮合, 策略代码可以在回测, 模拟盘, 实盘间无缝迁移, 无须改动代码, 保证了逻辑的完全一致性;  
（4）策略运行中用到数据会自动拉取到本地, 并且会自动增量更新, 策略运行过程中会自动使用本地缓存数据 ,保证了获取数据的效率；  
（5）在资金利用率上，优品量化平台支持策略组合, 即一个账号下运行多个策略, 以提高资金的利用率;  
（6）优品量化平台在架构和协议上支持多元资产管理(A股,期货,基金等), 即一个策略能交易多种不同品种;  
（7）云端量化引擎支持实时风控, 可以实现账户粒度, 策略粒度的各级风控保护;

## 金融数据
数据作为量化的基础，对数据多样性、历史数据的准确性、实时数据的及时性是有严格要求的。优品量化提供包括以下数据：

（1）近十年多品种(A股, 期货,)、多频率（Tick、分钟级、日线级）的历史数据  
（2）股票指数、行业板块的历史成分股数据  
（3）财务及相关指标数据  
（4）交易衍生指标数据  

另外为了提高策略内获取数据的速度，用到的数据会通过SDK自动拉取到本地并缓存，后续使用会自动增量更新(策略无感知)。快速加载、极大的提高策略的运行速度。

## 量化引擎
在优品量化引擎中, 最核心的莫过于用户/仓位/订单/回测管理模块。这些模块都依托于核心的异步事件模块之上，共同构建了量化从回测、模拟盘到实盘的整体过程。

用户管理模块主要管理用户多市场账户、基本资产等信息。在设计上，一个用户下可以创建多个策略，策略共享用户的资金池，从而保证了资金利用率最大化。

仓位管理以行情为驱动，实时计算用户的仓位信息，用于实时风控等核心管理。设计上用户有整体仓位信息、盈亏信息，同时每个策略也有自己的盈亏信息，可以独立管理。

这种用户和仓位管理的设计模式能够更有效的组合策略，降低回撤，提高收益，实现真正的智能投顾。

订单模块主要用于管理下单、成交回报，订单在设计上最重要是考虑的下单安全性，避免策略出现异常，给资金带来极大的风险，因此订单模块做了如下机制:
（1）内嵌订单状态机，保证同一标的同一方向同一时刻只能有一个挂单；  
（2）对于下单指令，统一通过SDK中指定仓位的方式来使用，不支持裸下单，订单模块会根据实际情况进行管理智能下单，保证挂单的正确性，并且后续完整的订单状态都会通知到SDK中；裸下单接口虽然直接，但是暴露出来的风险很难管理；  
（3）对于期货下单，同一标的同一时刻不允许相同价格两个方向的挂单，避免自成交；  
（4）通过以上机制来保证策略异常情况下，也不会发生同时下很多单的故障，最大限度保证资金安全。  
在设计上，回测模块其实相当于完整的封闭环境，内部包含了所有需要的模块，并且为了和实盘环境模拟一致，回测过程也是全异步的交互机制，从而保证策略回测代码能无缝迁移到模拟盘/实盘。另外回测完毕后会释放掉相关资源，提高资源利用率。

量化引擎在数据存储上也采用异步通知机制，所有订单/仓位等需要存储的信息都会异步写入到数据中，避免写IO阻塞正常请求，从而提升整体系统的性能。

## sdk
针对策略开发者使用上，我们抛弃了传统客户端模式(要求使用者下载量化平台的PC客户端，安装后依托客户端写策略的模式)。 

我们仅仅提供基本的SDK，通过异步网络通信机制和优品量化引擎进行交互，而数据又可以通过在web上实时管理。 这样设计虽然增加了整体系统的复杂度，但却大幅度降低了策略开发者的使用门槛，带来的好处却显而易见。

（1）策略开发可以在本地开发者自己的IDE上进行，最大程度保留了开发者的开发和调试习惯；  
（2）SDK目前支持Python/C++语言，在开发者本机运行， 如果希望使用深度学习/GPU等高级特性，就不存在任何障碍；  
（3）基于SDK实现的策略，在模拟盘(实盘)运行时可以分布到多机运行，而资金的管理和风控又可以集中在web上统一管理，甚至可以通过手机端来管理，对于专业的机构投资者来说极大的方便了整体策略的管理；  
（4）对于专业投资者，我们可以把优品核心的量化引擎通过docker方式部署在机构自己的服务器上；  
（5）SDK也提供了接口，可以让开发者将自己的数据源接入到SDK中(缓存在本地)，方便开发者使用。  

## web管理
Web管理是量化平台最重要的管理平台，主要包含了以下功能：

（1）行情，可以直接在管理页面上关注股票实时接收行情；  
（2）手工下单买卖，必要时可以直接在管理平台上下单买卖；  
（3）创建回测、查看回测进度和回测结果；  
（4）创建模拟/实盘策略, 查看策略运行数据；  
（5）对策略和策略的参数管理；  
（6）用户和账户管理。  

## 部署架构
对于普通用户，可以直接在用户自己的机器上，引用优品量化SDK实现策略并连接到优品量化云。如果要追求更快的速度可以联系我们，用户自己在阿里云/腾讯云上购买服务器，我们开放权限，通过阿里云/腾讯云内网进行连接速度会更快。

对于机构投资者，我们可以把优品量化引擎通过docker方式部署在机构的机器上，然后机构的策略连接自己的私有云即可。

在整体策略部署上，策略可以分布式部署，不同策略根据需要部署在不同机器上；对于机构投资者，可以把优品量化引擎也分布式部署在不同机器上，但是同一个账户都只能隶属于同一个优品量化引擎，可以通过web管理来配置账户的机器的对应关系。部署图如下：
![](http://cdn.upchina.com/uptest/201801/781411729c0143a0d205e74c92590f6e.jpg)

