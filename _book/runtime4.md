# 运行环境
## 支持语言及所需模块
平台目前支持C++及Python语言，Python支持的版本为Python3.6。

Python版本的SDK运行，需要安装的基础模块有：six1.11.0及以上版本、addict1.0.0及以上版本、pandas。建议安装Anaconda（[点击此处下载安装Anconda3-5.2.0，快速实现python3.6环境](https://repo.continuum.io/archive/Anaconda3-5.2.0-Windows-x86_64.exe)）已包含相关的第三方库。

## 行情订阅
平台提供实时行情和历史行情。目前平台支持的行情频率有tick、1分钟、5分钟、15分钟、30分钟、60分钟、日线级。A股数据目前不支持tick级。
**如需使用Tick数据，请联系我们：请联系我们（QQ群：648583092）**
对于实时行情，分钟级和日线数据在`on_bar/on_handle_data`内进行触发。在创建回测或者运行实例的时候可以选择回调函数响应的周期。
对于历史行情，可以通过API进行调用。在创建回测或者运行实例的时候选择要用到的数据频率，可以订阅多种周期。也可以自行选择行情数据的复权模式。

目前提供的历史数据如下：

A股：

频率| 历史数据区间
-- |--
日线级|	2011年1月1日起至今
分钟级|	2015年1月1日起至今

期货：

频率	|历史数据区间
-- |  --
tick级|	2017年10月9日起至今
分钟级|	2015年1月1日起至今
日线级|	2011年1月1日起至今


## 撮合机制
### 回测环境

【市价单】

按天回测：若在开盘前下单，则采用当天的开盘价下单；若在`on_bar`函数中下单则采用当天的收盘价下单。

分钟回测：若在开盘前下单，则采用当天的开盘价下单；若在`on_bar`函数中下单则采用这根`bar`的收盘价下单。

Tick回测：以当前`tick`买价卖，以当前`tick`卖价买。

 【限价单】

以委托价进行挂单。

按天回测目前不支持限价单。

分钟回测按照该分钟bar的`close`进行撮合，若不成交，则挂单之后每分钟均按分钟bar的`close`撮合，未成交部分顺延至下一分钟进行撮合，直到完全成交或者当天收盘为止。

按tick下单之后，若不是立即成交，则根据每个tick数据的对手价撮合成交，直到成交或收盘为止。

上述过程中若实际价格已经涨停或者跌停，则买单或卖单不成交，相应的市价单直接取消，限价单会挂单直到可以成交。一天结束后，所有未成交的订单会被取消。

### 交易环境
在开盘前下的单都会以当日的第一根行情价格进行撮合成交。盘中挂单都会以tick进行实时撮合，只是由于on_bar的响应频率不同导致策略逻辑执行的周期不同。

【市价单】

按天交易：可以选择日K距离收盘几分钟进行返回，以这根返回的bar的`close`后的最新行情价进行下单撮合，不成交或未成交部分即刻取消委托。

按分钟交易：当前分钟bar结束后的现价撮合。忽略最后每个交易日最后一个bar。

【限价单】

挂单后会以最新行情进行撮合，若不成交，则每个tick都进行撮合直至成交或收盘。

## 交易引擎

### 交易税费
在回测时可以设置交易税费，默认为0，单位为万分之。

### 滑点
采取N个最小变动价格单位的形式来设置滑点，1个单位代表一跳。滑点设置后，买入价格调整为 价格+滑点跳数的价格；卖出价格调整为 价格-滑点跳数的价格。

### 执行时间
onBeforeMarketOpen的执行时间在开盘前，具体时间可以由用户根据自己策略的复杂度自行设置。

onTick、onBar函数则是在收到对应行情时触发，每个标的都会触发一次回调函数。

### 交易环境下日k的收取
在交易环境，一般情况下当日K收到时当日的交易时段已经结束。为了能让用户在收盘前有处理的时间，可以对日K收取的时间进行设置，例如设置股票市场提前3分钟收取日K，则在14:57分的时候就可以收到当天的日K。

### 除权除息
当股票发生分红拆分时，股价会发生变化，往往在股价走势图上出现向下的跳空缺口。在回测部分我们默认提供不复权的数据，用户可以利用我们提供的复权因子数据自行计算除权除息，系统会在回测时自动处理好除权除息的问题，计算对应的价格和数量。若需要获取历史的数据，我们提供了获取前复权数据的API来保证数据的平滑。

### 期货连续合约跳空
对于期货数据的连续合约，由于换合约导致的跳空，也采用前复权的方式来进行处理。

### 期货交割日处理
期货持仓到交割日若没有手动交割，系统会以当天结算价平仓。

## 业绩评价
### 策略收益率
策略收益率表示策略回测区间的收益率，计算公式如下：
![](http://cdn.upchina.com/uptest/201710/f14bf5faa16e93574babcc4d03609527.jpg)
### 基准收益率
基准收益率表示基准在策略回测区间的收益率，一般默认沪深300为基准，计算公式如下：
![](http://cdn.upchina.com/uptest/201710/9f45b4c5f4f69fd526fdc40ae8c74e88.jpg)
### 策略年化收益率
策略年化收益表示回测区间内策略的复合年化收益率，计算公式如下：
![](http://cdn.upchina.com/uptest/201711/5f7b7aa650c10c57977bd84c81d96e70.jpg)

### 策略收益波动率
策略收益波动率是用来测量策略的风险性的，其值越大表示风险越大，计算公式如下：
![](http://cdn.upchina.com/uptest/201806/4c952f46d638801030d5e703f84a3af0.jpg)

### 夏普比率
夏普率表示每承受一单位总风险所获得的超额报酬，计算公式如下：
![](http://cdn.upchina.com/uptest/201806/9ae92783aa3147a870d52df6b8687a75.jpg)

### 平仓胜率
用户平仓胜率等于平仓盈利的次数除以总的平仓次数。

### 最大回撤
最大回撤用来描述策略可能出现的最糟糕的情况，计算公式如下：
![](http://cdn.upchina.com/uptest/201710/3868e9abb89d3e0ea9784fdb34b713f5.jpg)




