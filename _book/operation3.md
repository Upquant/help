# 使用说明
## 开启量化之旅
- 在本文档中，我们详细介绍了平台的各项功能和使用方法，也可以观看我们的[新手入门视频教程](https://upfv.upchina.com/quant/second.mp4)熟悉量化平台。实现一个简单的本地策略主要有以下步骤：

| 序号 | 平台 | 步骤说明                                 |
| ---- | ---- | ---------------------------------------- |
| 1    | 本地 | 下载安装SDK                              |
| 2    | 本地  | 编辑策略代码，对应具体策略执行逻辑               |
| 3    | Web  | 对策略进行组合，创建回测或者运行实例。   |
| 4    | 本地 | 在策略文件中配置对应策略回测信息并运行策略       |
| 5    | Web  | 在Web端查看回测报告                      |


下面以Python为例对具体的操作步骤进行详细说明。   
                
## 进入量化平台
首先打开量化官网，然后点击“登录”，会弹出登陆框，用户可以使用QQ、微信直接登录，也可以输入优品账号进行登录。
![](http://cdn.upchina.com/uptest/201811/1541573893256_20181107145813_2f489ed2ca0911ef.jpg)
登录量化官网后点击“量化平台”，进入到我们的量化平台
![](http://cdn.upchina.com/uptest/201811/1541574215187_20181107150335_997051a72e34a5ef.jpg)
进入量化平台后，会自动生成用于config中配置的user和token，点击自动生成的用户名会显示user和token，如下图所示
![](http://cdn.upchina.com/uptest/201811/1541574786683_20181107151306_66d8f09d9002aeae.jpg)

## sdk下载
优品量化SDK提供多平台多语言支持。支持C++、python语言（建议使用python3.6，[点击此处下载安装Anconda3-5.2.0，快速实现python3.6环境](https://repo.continuum.io/archive/Anaconda3-5.2.0-Windows-x86_64.exe)），以及Windows（64位）和Linux（64位）平台。
### sdk解压
SDK下载解压后结构如下：

```
 SOMEPATH
 
- example
   - BuySell-symbol  -- 策略文件夹
      - buySellSymbol.py  --python策略程序文件
- sdk
   - etasdk-1.0.1546-py2.py3-none-win_amd64.whl    --python包安装文件
```

### 安装python包
安装好python与pip后
在当前SDK文件夹路径处输入：cmd，回车，可直接打开当前路径命令提示符，如下图：
 ![](http://cdn.upchina.com/uptest/201903/1551953283685_20190307180803_3af810c2edaca447.jpg)
![](http://cdn.upchina.com/uptest/201903/1551953292590_20190307180812_2ffc0acfa15266bd.jpg)
输入： `pip install etasdk-1.0.1553-py2.py3-none-win_amd64.whl `，回车，结果如下图：
 ![](http://cdn.upchina.com/uptest/201903/1551953447405_20190307181047_1f0169a5a1f03019.jpg)

linux shell:
```
[user@localhost~]$pip install  ~/ SOMEPATH /sdk/etasdk-1.0.1546-py2.py3-none-win_amd64.whl  
```

### sdk升级
SDK升级时，下载到新版本的SDK后，对*WHL文件直接进行安装即可。

### 文件说明

示例文件中config配置。(注：在策略中config配置或者单独config文件配置均可），各项意义如下：
```
 config = {  
        "host": "120.55.22.60",
        "port": 80,
        "user" : "SDK-User",    //Web端：点击量化平台右上角用户名可查看填写，登录地址： http://quant.upchina.com/quantstmall/main
        "token" : "SDK-Token", //Web端：点击量化平台右上角用户名可查看填写
        "strategy_name": "buySellSymbol",  # Web端：策略名称
        "console": 0,
        "loglevel": "ERROR",  # 显示日志级别，具体可查看帮助文档
        # Web端：回测记录中本策略的回测ID,点击复制ID,粘贴此处即可
        "instance_id": "20190222-095421-222-002BI",
        # 初始化参数
        "initialize": {
            # symbols里设置单个股票或者其他有效的标的
            # symbol_sets里设置标的集合，如此处的IF.PRD指的就是IF品种的所有标准合约，不包含IFZ0.CF和IFZ1.CF
            # 注：symbols和symbol_sets不能全部为空
            'symbols': ['000001.CS'],
            # fields缓存的因子
            'fields': ['FUT_TRADE_RANK', 'FUT_SHORT_RANK', 'FUT_LONG_RANK'],
            # 必填：设置所需k线类型，interval可以选取1分钟，5分钟，15分钟，30分钟，60分钟，日k，Tick级别，count为提前缓存的数目
            'prepared_bars': [{'interval': ETimeSpan.DAY_1, 'count': 60}],
            # 选填：设置撮合参数 interval为撮合周期，time_ranges为日内撮合时间段，将只在指定时间段以interval周期回调on_bar或on_handle_date
            'match_param': {
                'interval': ETimeSpan.DAY_1,
                # 'time_ranges': [('12:00', '14:45'), ('10:10', '11:00')]
            },

            'mode': 'both',                       # 选填：为group_only，则只响应on_handle_data；为single_only，则只响应on_bar；为both，则两个回调同时响应
            'commission': 0.0002,                       # 选填：设置手续费
            # 选填：仅回测生效的项，不设置时以web页面上的设置为准
            'backtest': {
                'start_date': 20180702,                 # 回测开始日期
                'end_date': 20181101,                   # 回测结束日期
                'slippage': 1,                          # 设置滑点,取值为整数,标的价格浮动最小单位值的整数倍
                # 设置账户初始资金
                'cash': {
                    'CS': 1000000,                            # 设置股票账户资金
                    'CF': 0                      # 设置期货账户资金
                }
            },

            # 选填：仅模拟盘/实盘生效的项
            'realtime': {
                'pre_market_time': '8:50',            # 设置开盘前回调on_before_market_open响应事件时间，默认为web页面上设置的时间
                'closing_time': '14:55',               # 设置收盘前最后一次回调on_bar或on_handle_data响应事件时间，默认为web页面上设置的时间
                'group_timeout': 10000,                # 设置group模式下的组播，等待多少ms则强制响应，默认为5000ms
                'timer_cycle': 60000                   # 设置onTimer响应时间(ms), 为0则不响应onTimer，默认情况下不回调onTimer
            }
        }
    }

```
上述例子仅为单策略示例情况，如需使用多策略，可在config中修改如下配置,然后运行策略文件

```
config = {
        ...
        # "strategy_name": "test",  # 策略名称
        "strategies": [
            {
                "strategy": "test.py",#策略文件
                "name": "test"    #策略名称
            },
            {
                "strategy": "test1.py",  #策略文件
                "name": "test1"   #策略名称
            }]
            ...
    }
```



## 策略研究
### 策略创建
策略创建包括两部分的操作：页面上策略管理和本地策略创建。

** 页面上策略管理 **

切换到策略管理tab可以对自己的策略进行管理，左侧是策略的列表，点击某个策略可以对其信息进行查看。策略名称是与本地代码中的配置进行对应的标识。点击新建策略按钮对策略进行创建，填写名称和说明、参数，参数分为两种，基础参数是指策略整体的参数，标的参数则是针对不同标的需要分别去设置的参数。调参是策略维护过程中一个非常重要的部分，用户可以直接在页面上设置策略参数，运行时动态调整而不用再去调整代码。 

策略列表有三个按钮，分别是：复制策略到实盘（若已开通实盘则可复制成功）、复制策略到模拟盘、删除策略。

![](http://cdn.upchina.com/uptest/201810/1540192111476_20181022150831_b2798dfefdc985e8.jpg)

已有的策略也可以进行查看、编辑和删除。但是需要注意，策略若已在实例使用则不可删除。

** 本地策略创建 **

项目需要保持example的工程结构，可直接在example目录下修改或增加策略的python代码。  
注：本地仅做策略研究时，建议使用etadata调用数据，可获取更好的交互式编程环境体验。

系统支持多种事件函数，不同事件有不同触发时机和相关数据。详见[API使用文档](api5.html#api使用文档)。

### 创建回测实例
创建回测实例是指填写策略回测参数，对一个或者多个策略创建与本地工程对应的实例。一个回测实例可以产生多条回测记录，每条回测记录有不同的回测ID来与本地的配置文件对应。

点击“创建实例”按钮，跳转到如下图界面。

![](http://cdn.upchina.com/uptest/201807/4f1f04592878d50e6841130419c3b4e4.jpg)

填写实例名称，选择策略，修改策略参数，选择回测区间、设置撮合周期、费率、滑点、初始资金。

**注意：**选择回测区间，设置撮合周期、费率、滑点以及初始资金可在策略py文件中相应配置中设置更改，且策略文件中如果有设置则以策略文件为准，具体示例参考[从一个简单的策略示例说起](api5.md#从一个简单的策略示例说起)

**参数说明如下：**

| 参数     | 说明                                                         |
| -------- | ------------------------------------------------------------ |
| 回测区间 | 回测周期包含开始的时间、结束时间                             |
| 撮合周期 | on_bar或者on_tick函数的响应周期，包括日K、Tick、1分钟、5分钟、15分钟、30分钟、60分钟 |
| 费率     | 默认为2，单位为万分之                                        |
| 滑点     | 默认为1，单位为跳（最小价格变动单位）                        |
| 初始资金 | 需要勾选市场，股票、期货均默认为1000000                      |

当市场选择为**股票**，回测默认盘前时间为08:50，模拟盘自己设置不影响

当市场选择为**期货**，回测默认盘前时间为20:50，模拟盘自己设置不影响

当市场同时选择期货和股票，回测默认盘前时间以**期货**为准，模拟盘自己设置不影响

点击“保存实例”，跳转到回测页面，生成回测列表。若想生成多条回测记录，则可以点击新建回测增加。
![](http://cdn.upchina.com/uptest/201810/1540192441915_20181022151401_6b25551ff4d47794.jpg)

### 运行回测
用户创建的本地策略需要与Web进行连接。以Web页面策略名称为buySellFutures，本地的策略文件以buySellFutures.py为例，需要在策略文件config中配置包括：`user`  `token` `strategy_name  ` `instance_id`   。


![](http://cdn.upchina.com/uptest/201903/1551958071769_20190307192751_947b7cd4d7f84fbd.jpg)


### 查看回测结果
回测详情可以在页面进行查看，包括收益概况，每日持仓，每日平仓，交易详情，标的统计，阶段统计，模块参数，日志等，以及运行本次策略的参数设置。回测完成后可以导出回测结果的相关数据，如：交易详情、收益权益概况、每日持仓和每日平仓以及标的统计的数据。实例可以修改后再次回测。
![](http://cdn.upchina.com/uptest/201810/1540192537229_20181022151537_719639b1e8a00233.jpg)
编辑回测：可以修改相关参数，并填写此次回测备注信息以介绍此次回测相关内容(注：除模块参数外，如果回测参数在本地策略文件中已经设置,则以本地策略文件设置为准)
![](http://cdn.upchina.com/uptest/201810/1540192589553_20181022151629_ac5558c749a5f6de.jpg)
## 模拟交易
### 模拟交易策略管理
用户需要对模拟交易和策略研究的策略分别进行管理。可以拷贝策略研究中的策略到模拟交易中。

### 创建模拟交易运行实例
点击“创建实例”按钮，跳转到如下图界面对模拟交易运行实例进行创建。
![](http://cdn.upchina.com/uptest/201810/1540192724754_20181022151844_baedf51f4e25bad2.jpg)

填写实例名称、开盘前onBeforeMarketOpen的响应时间、收盘前日Kbar的返回时间，选择策略、修改策略参数、选择撮合周期，点击“保存实例”，跳转到策略运行页面。如下图：

![](http://cdn.upchina.com/uptest/201901/1547536674555_20190115151754_65feec146d416a90.jpg)

模拟交易的策略运行页面可查看模拟交易的实例收益情况及运行状态。

未连接：需要将模拟交易实例ID，复制到本地代码配置文件config中，运行本地策略即可连接；

已连接：实例已连接平台模拟交易，依据实盘交易规则模拟运行。

已断开：代码运行过，现已断开。

### 模拟运行实例
用户创建的本地策略需要与本地进行连接。直接复制回测ID到本地策略文件中config下的"instance_id"处。以页面策略名称为test，本地的策略代码以s_custome.py为例，相关配置如下：

```
config = {
         ...
        "strategy_name": "test", # 策略名称
        “instance_id”:” 20180928-111030-678-001S”   //模拟运行时的实例ID


```
### 查看模拟运行详情
点击实例卡片进入实例详情页面，如下图：
![](http://cdn.upchina.com/uptest/201901/1547537502700_20190115153142_20df8aaad0f93c08.jpg)

遇到特殊情况，可在交易时间段内选择一键平仓（如策略同时包括股票、期货，必须同时都满足为交易时间段，方可执行一键平仓），**请谨慎使用**

### 模拟运行中调参
模块参数在运行中可以进行调整，根据不同的市场行情，可以选择启用/停用已选择的策略，模块参数也能在页面中直接进行修改，不用去修改代码。
![](http://cdn.upchina.com/uptest/201901/1547537693797_20190115153453_a2b8b27699cf86de.jpg)
如图中所示，可点击 策略参数-->编辑，调整初始资金，点击保存。参数修改成功。

### 模拟运行中手动下单
模拟交易实例满足交易时间内手动下单调仓。界面如下图所示：
![](http://cdn.upchina.com/uptest/201901/1547537900505_20190115153820_d50086e86210704a.jpg)
**注意：**股票只满足多方操作。委托的仓位为您所需的目标仓位。
### 模拟运行中盘前挂单
模拟交易实例满足非交易时间内盘前挂单，盘中撮合。界面如图所示：

![](http://cdn.upchina.com/uptest/201901/1547538826620_20190115155346_fd4133d9ce9c11c7.jpg)

**注意：**盘前挂单只在非交易时间段内（如A股在9:30之前以及11:30~13:00之间）可挂单，撤销等操作。交易时间段内撮合。
### 查看模拟账户
点击“账户”，显示该用户所有账户的收益情况、开平仓明细和订单明细。
![](http://cdn.upchina.com/uptest/201810/1540192992938_20181022152312_6a81e8bf849ec956.jpg)

### 风控管理
风控管理分为账户风控和实例风控。账户风控有账户指标风控和账户级别的合约风控；实例风控有实例指标风控和实例级别的合约风控。风控创建好后需要手动点击开启按钮才会开启。
![](http://cdn.upchina.com/uptest/201810/1540193067472_20181022152427_b13574cf71b87f5c.jpg)

## 实盘交易
### 创建实盘交易运行实例
操作与模拟交易一致，先创建策略或者通过拷贝策略研究中的策略到实盘交易中，然后点击“创建实例”按钮，跳转到如下图界面对实盘交易运行实例进行创建。填写实例名称、开盘前onBeforeMarketOpen的响应时间、收盘前日Kbar的返回时间，选择策略、修改策略参数、选择撮合周期。
![](http://cdn.upchina.com/uptest/201810/1540193173361_20181022152613_0367ef65f28a8845.jpg)

点击“保存实例”，跳转到策略运行页面。如下图：

![](http://cdn.upchina.com/uptest/201810/1540193230889_20181022152710_e3169d8fa2bda437.jpg)

实盘交易的策略运行页面可查看实盘交易的实例收益情况及运行状态。

未连接：需要将实盘交易实例ID，复制到本地代码找到相应的配置"instance_id"处粘贴，运行本地策略即可连接；

已连接：实例已连接平台实盘交易；

已断开：代码运行过，现已断开。

### 实盘运行实例
同模拟交易一样，用户创建的本地策略需要与本地进行连接。直接复制回测ID到本地策略文件中config下的"instance_id"处。以页面策略名称为test，本地的策略代码以s_custome.py为例。，相关配置如下。

```
config = {
         ...
        "strategy_name": "s_custome", # 策略名称
        “instance_id”:” 20181219-152331-967-001SR”   //实例ID



```
### 查看实盘运行详情
点击“实例卡片进入实例详情页面，如下图：
![](http://cdn.upchina.com/uptest/201901/1547539926265_20190115161206_26256f624e266033.jpg)

遇到特殊情况，可在交易时间段内选择一键平仓（如策略同时包括股票、期货，必须同时都满足为交易时间段，方可执行一键平仓），**请谨慎使用**
### 实盘运行中调参
模块参数在运行中可以进行调整，根据不同的市场行情，可以选择启用/停用已选择的策略，模块参数也能在页面中直接进行修改，不用去修改代码。
![](http://cdn.upchina.com/uptest/201901/1547540009971_20190115161329_d07004d0a23e8100.jpg)
如图中所示，可点击 策略参数-->编辑，调整初始资金，点击保存。参数修改成功。
### 实盘运行中手动下单
实盘交易实例满足交易时间内手动下单调仓。界面如下图所示：
![](http://cdn.upchina.com/uptest/201901/1547540261227_20190115161741_bca4fa86f9d1fb46.jpg)
**注意**股票只满足多方操作。委托的仓位为您所需的目标仓位。
### 实盘运行中盘前挂单
实盘交易实例满足非交易时间段内挂单，盘中撮合。界面如下图所示：
![](http://cdn.upchina.com/uptest/201901/1547540525114_20190115162205_3283ba85e2a4ff25.jpg)
**注意**盘前挂单只在非交易时间段内（如A股在9:30之前以及11:30~13:00之间）可挂单，撤销等操作。交易时间段内撮合。
### 查看实盘账户
点击“账户”，显示该用户所有账户的收益情况、开平仓明细和订单明细。
![](http://cdn.upchina.com/uptest/201810/1540193335300_20181022152855_d8fa701236a5ad0f.jpg)

**如需开通实盘交易服务，请联系我们（QQ群：648583092）。**

### 实盘风控管理
风控管理分为账户风控和实例风控。账户风控有账户指标风控和账户级别的合约风控；实例风控有实例指标风控和实例级别的合约风控。风控创建好后需要手动点击开启按钮才会开启。

![](http://cdn.upchina.com/uptest/201810/1540193402772_20181022153002_18fac1a4cff733cf.jpg)

